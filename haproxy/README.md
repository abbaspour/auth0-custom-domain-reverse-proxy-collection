# HAProxy Reverse Proxy for Auth0 Custom Domain

This directory contains the configuration for using HAProxy as a reverse proxy for Auth0 custom domains.

> **Tested with HAProxy version:** 2.8.5

[Return to main README](../README.md)

## Overview

HAProxy is configured to:
- Listen on port 8080 for HTTP traffic and redirect it to HTTPS
- Listen on port 8443 for HTTPS traffic and proxy it to Auth0
- Add the required `cname-api-key` header to requests to Auth0

## Prerequisites

- HAProxy installed on your system
- Environment variables set in `.env` file (created by Terraform)

## Setup

1. Run Terraform to create the Auth0 custom domain and generate the `.env` file:
   ```
   cd ../terraform
   terraform apply
   ```

2. Start HAProxy:
   ```
   make run
   ```

## Available Commands

- `make` or `make all` - Run HAProxy
- `make run` - Run HAProxy on ports 8080 and 8443
- `make stop` - Stop HAProxy
- `make reload` - Reload HAProxy configuration
- `make log` - View logs
- `make help` - Show help message

## Configuration Files

- `haproxy.cfg.template` - Template for HAProxy configuration
- `haproxy.cfg` - Generated HAProxy configuration (do not edit directly)
- `.env` - Environment variables (generated by Terraform)

## Environment Variables

The following environment variables are required:
- `CNAME_API_KEY` - API key for Auth0 custom domain
- `AUTH0_EDGE_LOCATION` - Auth0 edge location domain
- `DOMAIN_NAME` - Your custom domain name

These variables are automatically set in the `.env` file by Terraform.

## SSL/TLS Certificates

SSL/TLS certificates are managed by Terraform. HAProxy uses the certificates that are generated and managed by the Terraform configuration.

## Troubleshooting

- Check the logs with `make log`
- Ensure the `.env` file exists and contains the required variables
- Make sure HAProxy is installed and available in your PATH